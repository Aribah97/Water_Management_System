#include "ValveController.h"\n\nValveController::ValveController(int pin)  \n    : controlPin(pin), currentState(VALVE_CLOSED),  \n      lastStateChangeTime(0), isInitialized(false) {\n}\n\nbool ValveController::openValve() {\n    if (!isInitialized) {\n        return false;\n    }\n    return setState(VALVE_OPEN);\n}\n\nbool ValveController::closeValve() {\n    if (!isInitialized) {\n        return false;\n    }\n    return setState(VALVE_CLOSED);\n}\n\nbool ValveController::setState(ValveState state) {\n    if (!isInitialized) {\n        return false;\n    }\n    \n    if (currentState != state) {\n        digitalWrite(controlPin, state);\n        currentState = state;\n        lastStateChangeTime = millis();\n        return true;\n    }\n    \n    return false;\n}\n\nValveState ValveController::getState() const {\n    return currentState;\n}\n\nbool ValveController::isOpen() const {\n    return currentState == VALVE_OPEN;\n}\n\nbool ValveController::isClosed() const {\n    return currentState == VALVE_CLOSED;\n}\n\nunsigned long ValveController::timeSinceStateChange() const {\n    return millis() - lastStateChangeTime;\n}\n\nvoid ValveController::emergencyClose() {\n    if (isInitialized) {\n        digitalWrite(controlPin, VALVE_CLOSED);\n        currentState = VALVE_CLOSED;\n        lastStateChangeTime = millis();\n    }\n}